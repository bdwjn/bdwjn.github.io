<!DOCTYPE html>
<html>
<title>Tetris</title>
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwA
	AEnQAABJ0Ad5mH3gAAAA8SURBVDhPY1AgEZCroYEIAFFJmYYNOABEFqKSGhogbAhAloWwB7sGCBsTIMtSpgE/gKgkVwPxgEQNCgoAeGr0gaidAEUAAAAASUVORK5CYII="/>
<style>
	html,body,canvas{background:black;padding:0;margin:0;overflow:hidden;width:100%;height:100%}
	canvas{object-fit:contain;image-rendering:pixelated;left:auto;right:auto}img{display:none}
</style>
<canvas id="tetris" width="160" height="144"></canvas>
<img id="data" alt="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAB9CAAAAAA35jpxAAAIK0lEQVR4AeyWi5GgMAxDKUUluSSXpBIPVkFDHDy5/18
	zIODIQ7Zzu3vwFl5FIpi6Tgb0HoMMrfgP+DsA+EYdiA8B+SH78vzOmRlpRZ4AnHoCcOoJ4KkElB0ILcwQ6AKQAowD5AzIhAFzgvg6gCNcvivB9wZ4rewrmiiFm/iNWgFCDw/UjcM
	4RZ/i0EAUvXpkNgBehwDp2mN4hu87QPBUDIAiAGl3grYEqSaoSVTCHqAIy0Ldh6YnwKuOeCYId98gxikBVH1NAMnNs0sroOggZrERinpAvAuNvjpBDK0AWasc4tAe0CTMoQGgQ+5
	Kqj0RQP85XgF9Mw3wsHcJJnWAvmYwr+PRzOtYS+jGlWOJMOagNLFPUL98JzrYD3tKUL88MO+AHGU/AfXLbQlanxEpQi1h6kXTxGQGEKc9E7RTqGP03wExJeimsAdstC2B9DBv0z3
	k+yaKQfJ+7b6S78ZogBMY5QT9RloBLqEm6FUBzv/ZAOps92PZFrAf4zfqKHOtUX3f+cHRJ53svvbcF9dxUO4EdrPG/QpQCXVnrWMjn2TZBAAKudm6TQk16uSsz2uibx/j9wCgblG
	6B/N4dV3/3VOoL05nud4rhwFLkhXgMTaAXQKOhQS+EkCu+2DfxPpc/hvvA+6iy0sPWA9JV18McIIegLmJtQRddoCy0QRwYD0uAN/7w2wATQldSQZ8o34PAPCLAf9L+NR4VUQ5khz
	RiMwqtVpZpVb3kGAgS9Nk5h4PK6Vm8PP9YqaqYTRrzMzsi5mZ7ZPZXjrubfm0zMz7o7Ka9jS1G0mKH/EzIPsNvenscSYiboRvJHqj6vfpjbovI0Ow5b4aVvptJy7wW8nPZ4h0KWR
	NAYeamFSpzH12v/1CYAZGdOn4246fPPMeRZyRgq6ufHs47LDqu/uiSUWJVh3VsRx0LFk9GzNFyshyLui4xyL3kChNKcJZogwwVsnOXBlxub+XXC1rl0ZJddb/w8Y9Jag2VwNipUt
	Gw4G7l1cCmS/FqeMDBIuM3bPP6tNu64m2cluPZfnOkhKtcvoSohphyWmb3W1qLiYDw47h3/1wyMoAL5ZabXLxOUtnMQ9fwExYhHIAzSg0/qLuHpqLA3hPSHccJZyTGvScVGqVoxo
	4qRnLM3QGZ5WlMzN5VDh15Pl6KpEwgfsoTcgqnAn5nN1DVUfC7j4qFo/5GVHM51ogF1D+Ap7+87kX1GUhak9V4WjglFPn3H2V1KcCCfKR9hcD4hbKqgErxTmv22nOkpCYOx2zJFC
	IyDiH7SVx6vqOrWjMtlL3UTmphc2IzUZlynAtud+OzA2eknnhTCsmb8CD3LNPP3nRfejDHy1b4QBjMANu3owQu6+KhZD/rBHyp2ZiWqXtHgTpkMIw5NDYwmnmwlNxYHx6oJqHPOF
	NTj/7zd/eTFktTKi4v3KP4mpkaSZmY2TS7pNDCDgp8IefWSnlKv4XuHBb93YizWsbJjZpWc7PJWGfi+GIE+2LBiuFwlFSFlKgDkFO1GplVPLKUDAE/58UtsIut2WVhOGLQ6nV2K2
	VjxagdiMC9AhHyzFLmYieo+8OrbVgpFcT9F1RzBDfyskYVNz/JLXCVINfoKWhlbfWJnpdvO7cV71cUNkgBQjMA5za1UIGD9/puUIy4EbIBpkQhUJ0LE3Ka62j0iS0bHWq+nbADS+
	jV0JLOCmn7dD3rkwRsZEfHNUgBo20OVpaAqFtIGeBGyn6aJU9lpOkCMzyvqqCReUE5jzv2GxdaElwS91ffhj/ivw671NlbH6K9T+ifYp8QkkuLGVoS6kLMuzSTc1oLr8bJ9d7sq3
	Wu9L/fJ/vcvxaOoGBM6cuYARNUistibIgbjaCSHAoLxHO8AAOpa5mCeqZhEmwKVzX8gCxK6NSAszhYl6AgpK7P8unXXSiHSIvmVjAHlbCzAZi4IIjy620sJYQ5YgljOXziYJhNJX
	rC+3/fOorP35/LQw6Eo9A4hHxhmIUA1tPJgS3TiW8Xks6L4MRqyUAQWYp6CP7AeiASyTdEToya084+YezKDRvfx4HUtRFXXOeF7YlV0tHyfyeOej7hkzIjawWnrZCqXIcRiq4+Yt
	T7yLLAzyYWiXKS3LD+wrosEcia5cNfWgz1FUEeVlQ8yCz7ndv+e03/7DF0q8+2eWPvF7+kEjyaTX7efj949XHX1r/tFm1Xh8pCqFkNlaMRRaV5F4Xub8US4zPJHo9sxcS5XuK1s3
	PtuBdAZa7IfHOSDDWlqeUKFrC7LueN3HAZngl6Ht/KOoQK1ota+OMK+Ngj7z7oKrNW1gqwMWLSeBfTEsCbCuharWvyYBaFgUQykNAVkkFq7yC2VfwiFWZDWv+acTdKL8byd1Iomv
	+RkEM1mWjeIzcZ8umMlbfJV+Dx/E0Yj++tbvvqNu/jSfI/bFsdk9sH5VvB/R7+3u9/eQOdmmM/Ceg6wXUbOWfgO4rm9mJVaNjs1Pd187T4aMz+8dKh/bP7D80ICA62Jmn3rQ7Ml4
	i+QYAJOrNd6amu/sn7E75EmH4j0FTAfDgkf3dAXF27aB5JW0Addz+bpeOEE1M5gReABD1jlK3N+V6Y9zejW+vAL9YAUsOBReQ0PwhDiaKA/H0V+zHir0ArtkAEP2bK+ZDaoJfuAc
	fvYiKj4UHJIZsgeyAtCC7Ia+BvALyEsgLIBK0BLJTgNshwxADqUAGIeXCWKmQsJCgEF3MUVylOnHcUFhhanJhhGSv4gamJs7rYqzmjxscxSJVxlrY0lb5AeC43hgV6nVIXK03onp
	jbPUa0G3KvMcbGRprxLw750DPAVO+GuyMzVaHAAAAAElFTkSuQmCC"/>
<script>
	i = document.images[0]
	
	c = document.createElement("canvas")
	c.width=i.width; c.height=i.height-80
	c = c.getContext("2d")
	c.drawImage(i, 0, -80)
	p = c.getImageData(0, 0, i.width, i.height-80).data.filter((_,i) => !(i%4))
	c = document.body.children[0].getContext("2d")

	document.addEventListener("keyup",   function(e) { w.instance.exports.k(e.key.charCodeAt(0), 1); })
	document.addEventListener("keydown", function(e) { w.instance.exports.k(e.key.charCodeAt(0), 0); })

	WebAssembly.instantiate( p, { env: {
		d: (x,y,tile)=>{ if (y>=0) c.drawImage(i,8*(tile&7),tile&248,8,8,8*x,8*y,8,8); },
		r: ()=>{ window.requestAnimationFrame(w.instance.exports.r); },
	}}).then(
		o=>{w = o; o.instance.exports.r(Math.random()*0xFFFFFFFF);}
	)
</script>
